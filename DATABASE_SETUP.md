# üóÑÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±–ª–∞—á–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üìã –í–∞—Ä–∏–∞–Ω—Ç—ã –æ–±–ª–∞—á–Ω—ã—Ö –ë–î

### 1. **MongoDB Atlas** (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω**: 512MB, 500 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**: –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞**: –æ—Ç–ª–∏—á–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### 2. **Supabase** (PostgreSQL)
- **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω**: 500MB, 50,000 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–µ—Å—è—Ü
- **–§—É–Ω–∫—Ü–∏–∏**: –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, real-time
- **SQL**: –∑–Ω–∞–∫–æ–º—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å

### 3. **PlanetScale** (MySQL)
- **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω**: 1GB, 1 –º–∏–ª–ª–∏–∞—Ä–¥ —Å—Ç—Ä–æ–∫
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–∞—è
- **Git-–ø–æ–¥–æ–±–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –ë–î**

### 4. **–Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–æ** (PostgreSQL/MySQL)
- **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω**: 15GB SSD, 2 —è–¥—Ä–∞, 2GB RAM –Ω–∞ 60 –¥–Ω–µ–π
- **–†–µ–≥–∏–æ–Ω**: –†–æ—Å—Å–∏—è (–±—ã—Å—Ç—Ä–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å)
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞**: –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ

### 5. **VK Cloud** (PostgreSQL/MySQL)
- **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω**: 15GB SSD, 1 —è–¥—Ä–æ, 1GB RAM –Ω–∞ 30 –¥–Ω–µ–π
- **–†–µ–≥–∏–æ–Ω**: –†–æ—Å—Å–∏—è
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: —Å VK —ç–∫–æ—Å–∏—Å—Ç–µ–º–æ–π

### 6. **Selectel** (PostgreSQL/MySQL)
- **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω**: 10GB SSD, 1 —è–¥—Ä–æ, 1GB RAM –Ω–∞ 14 –¥–Ω–µ–π
- **–†–µ–≥–∏–æ–Ω**: –†–æ—Å—Å–∏—è
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –ª–µ–≥–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

## üá∑üá∫ –†–æ—Å—Å–∏–π—Å–∫–∏–µ –æ–±–ª–∞—á–Ω—ã–µ –ë–î (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –†–§)

### üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–æ

#### –®–∞–≥ 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ [cloud.yandex.ru](https://cloud.yandex.ru)
2. –ù–∞–∂–º–∏—Ç–µ "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ"
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É (–Ω—É–∂–Ω–∞ –∫–∞—Ä—Ç–∞ –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏)

#### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –ë–î
1. –í –∫–æ–Ω—Å–æ–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ "Managed Service for PostgreSQL"
2. –ù–∞–∂–º–∏—Ç–µ "–°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Ç–µ—Ä"
3. –í—ã–±–µ—Ä–∏—Ç–µ "–°—Ç–∞—Ä—Ç–æ–≤—ã–π" –ø–ª–∞–Ω (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π)
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ:
   - **–ò–º—è**: `nimblebot-db`
   - **–ü–∞—Ä–æ–ª—å**: `—Å–ª–æ–∂–Ω—ã–π_–ø–∞—Ä–æ–ª—å_123!`
   - **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: `nimblebot`

#### –®–∞–≥ 3: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```
postgresql://nimblebot:–ø–∞—Ä–æ–ª—å@c-xxxxx.rw.mdb.yandexcloud.net:6432/nimblebot
```

### üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ VK Cloud

#### –®–∞–≥ 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ [mcs.mail.ru](https://mcs.mail.ru)
2. –ù–∞–∂–º–∏—Ç–µ "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ"
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

#### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –ë–î
1. –í—ã–±–µ—Ä–∏—Ç–µ "–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö" ‚Üí "PostgreSQL"
2. –ù–∞–∂–º–∏—Ç–µ "–°–æ–∑–¥–∞—Ç—å –∏–Ω—Å—Ç–∞–Ω—Å"
3. –í—ã–±–µ—Ä–∏—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

## üöÄ –ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ MongoDB Atlas

### –®–∞–≥ 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ [mongodb.com/atlas](https://mongodb.com/atlas)
2. –ù–∞–∂–º–∏—Ç–µ "Try Free"
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞
1. –í—ã–±–µ—Ä–∏—Ç–µ **"FREE"** –ø–ª–∞–Ω (M0)
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (AWS/Google Cloud/Azure)
3. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω (–±–ª–∏–∂–∞–π—à–∏–π –∫ –≤–∞–º)
4. –ù–∞–∂–º–∏—Ç–µ "Create"

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
1. **Database Access**:
   - –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë–î
   - –õ–æ–≥–∏–Ω: `nimblebot`
   - –ü–∞—Ä–æ–ª—å: `—Å–ª–æ–∂–Ω—ã–π_–ø–∞—Ä–æ–ª—å_123!`
   - –†–æ–ª—å: `Read and write to any database`

2. **Network Access**:
   - –ù–∞–∂–º–∏—Ç–µ "Add IP Address"
   - –í—ã–±–µ—Ä–∏—Ç–µ "Allow Access from Anywhere" (0.0.0.0/0)
   - –ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

### –®–∞–≥ 4: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
1. –ù–∞–∂–º–∏—Ç–µ "Connect"
2. –í—ã–±–µ—Ä–∏—Ç–µ "Connect your application"
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
```
mongodb+srv://nimblebot:–ø–∞—Ä–æ–ª—å@cluster0.xxxxx.mongodb.net/?retryWrites=true&w=majority
```

## üîß –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**–î–ª—è —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (PostgreSQL):**
```bash
pip install psycopg2-binary
```

**–î–ª—è –∑–∞—Ä—É–±–µ–∂–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (MongoDB):**
```bash
pip install pymongo
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `requirements.txt`

**–î–ª—è —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:**
```
psycopg2-binary==2.9.9
```

**–î–ª—è –∑–∞—Ä—É–±–µ–∂–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:**
```
pymongo==4.6.1
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `bot.py` (PostgreSQL –¥–ª—è —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤)

```python
import psycopg2
import os
from psycopg2.extras import RealDictCursor

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL (–Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–æ/VK Cloud)
DATABASE_URL = "postgresql://nimblebot:–ø–∞—Ä–æ–ª—å@c-xxxxx.rw.mdb.yandexcloud.net:6432/nimblebot"

def get_db_connection():
    return psycopg2.connect(DATABASE_URL)

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã (–≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–¥–∏–Ω —Ä–∞–∑)
def create_tables():
    conn = get_db_connection()
    cur = conn.cursor()
    cur.execute("""
        CREATE TABLE IF NOT EXISTS user_balances (
            user_id BIGINT PRIMARY KEY,
            stars INTEGER DEFAULT 0,
            ton DECIMAL(10,2) DEFAULT 0.00,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        );
    """)
    conn.commit()
    cur.close()
    conn.close()

# –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–ª–∞–Ω—Å–æ–º
def get_user_balance(user_id: int):
    conn = get_db_connection()
    cur = conn.cursor(cursor_factory=RealDictCursor)
    cur.execute("SELECT stars, ton FROM user_balances WHERE user_id = %s", (user_id,))
    result = cur.fetchone()
    cur.close()
    conn.close()
    
    if result:
        return {"stars": result['stars'], "ton": float(result['ton'])}
    return {"stars": 0, "ton": 0}

def update_user_balance(user_id: int, currency: str, amount: float):
    conn = get_db_connection()
    cur = conn.cursor()
    
    if currency == "stars":
        cur.execute("""
            INSERT INTO user_balances (user_id, stars, updated_at) 
            VALUES (%s, %s, CURRENT_TIMESTAMP)
            ON CONFLICT (user_id) 
            DO UPDATE SET stars = user_balances.stars + %s, updated_at = CURRENT_TIMESTAMP
        """, (user_id, amount, amount))
    elif currency == "ton":
        cur.execute("""
            INSERT INTO user_balances (user_id, ton, updated_at) 
            VALUES (%s, %s, CURRENT_TIMESTAMP)
            ON CONFLICT (user_id) 
            DO UPDATE SET ton = user_balances.ton + %s, updated_at = CURRENT_TIMESTAMP
        """, (user_id, amount, amount))
    
    conn.commit()
    cur.close()
    conn.close()
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `bot.py` (MongoDB –¥–ª—è –∑–∞—Ä—É–±–µ–∂–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤)

```python
from pymongo import MongoClient
import os

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MongoDB
MONGO_URI = "mongodb+srv://nimblebot:–ø–∞—Ä–æ–ª—å@cluster0.xxxxx.mongodb.net/?retryWrites=true&w=majority"
client = MongoClient(MONGO_URI)
db = client.nimblebot
balances_collection = db.user_balances

# –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–ª–∞–Ω—Å–æ–º
def get_user_balance(user_id: int):
    user_doc = balances_collection.find_one({"user_id": user_id})
    if user_doc:
        return {"stars": user_doc.get("stars", 0), "ton": user_doc.get("ton", 0)}
    return {"stars": 0, "ton": 0}

def update_user_balance(user_id: int, currency: str, amount: float):
    if currency == "stars":
        balances_collection.update_one(
            {"user_id": user_id},
            {"$inc": {"stars": amount}},
            upsert=True
        )
    elif currency == "ton":
        balances_collection.update_one(
            {"user_id": user_id},
            {"$inc": {"ton": amount}},
            upsert=True
        )
```

## üîê –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –ù–∞ Railway:
1. –ó–∞–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
2. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é:
   - **–ö–ª—é—á**: `MONGO_URI`
   - **–ó–Ω–∞—á–µ–Ω–∏–µ**: –≤–∞—à–∞ —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### –õ–æ–∫–∞–ª—å–Ω–æ:
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:
```
MONGO_URI=mongodb+srv://nimblebot:–ø–∞—Ä–æ–ª—å@cluster0.xxxxx.mongodb.net/?retryWrites=true&w=majority
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –ö–æ–ª–ª–µ–∫—Ü–∏—è: `user_balances`
```json
{
  "user_id": 2029065770,
  "stars": 1000,
  "ton": 100.00,
  "created_at": "2024-01-01T00:00:00Z",
  "updated_at": "2024-01-01T00:00:00Z"
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```python
# –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –±–æ–ª—å—à–∏–º –±–∞–ª–∞–Ω—Å–æ–º
update_user_balance(2029065770, "stars", 1000)
update_user_balance(2029065770, "ton", 100.00)
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ –ø–∞—Ä–æ–ª–∏ –≤ Git
2. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ**: MongoDB Atlas –¥–µ–ª–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ä–µ—Å—É—Ä—Å–æ–≤
4. **–ò–Ω–¥–µ–∫—Å—ã**: –¥–æ–±–∞–≤—å—Ç–µ –∏–Ω–¥–µ–∫—Å –Ω–∞ `user_id` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ `user_balances.json`:
```python
import json

# –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
with open('user_balances.json', 'r') as f:
    old_data = json.load(f)

# –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ MongoDB
for user_id, balance in old_data.items():
    balances_collection.update_one(
        {"user_id": int(user_id)},
        {"$set": balance},
        upsert=True
    )
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- **MongoDB Atlas**: [docs.atlas.mongodb.com](https://docs.atlas.mongodb.com)
- **PyMongo**: [pymongo.readthedocs.io](https://pymongo.readthedocs.io)
- **Railway**: [docs.railway.app](https://docs.railway.app) 